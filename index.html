<?php
// Check if the request method is POST
if ($_SERVER["REQUEST_METHOD"] == "POST") {

    // --- 1. Sanitize and Validate Input ---
    
    // Sanitize string inputs
    $firstName = htmlspecialchars($_POST['firstname'] ?? '');
    $lastName = htmlspecialchars($_POST['lastname'] ?? '');
    $email = filter_var($_POST['email'] ?? '', FILTER_SANITIZE_EMAIL);
    $phone = htmlspecialchars($_POST['phone'] ?? '');
    $course = htmlspecialchars($_POST['course'] ?? '');
    $gender = htmlspecialchars($_POST['gender'] ?? '');

    // Basic Validation
    if (empty($firstName) || empty($lastName) || empty($email) || empty($course) || empty($gender)) {
        http_response_code(400); // Bad Request
        echo "Error: Required fields are missing.";
        exit;
    }

    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
        http_response_code(400);
        echo "Error: Invalid email format.";
        exit;
    }

    // --- 2. Process Data (Database Insertion/Email Notification) ---
    /*
    // In a real application, you would perform database operations here:
    
    $servername = "localhost";
    $username = "db_user";
    $password = "db_password";
    $dbname = "university_db";
    
    try {
        $conn = new PDO("mysql:host=$servername;dbname=$dbname", $username, $password);
        $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

        $stmt = $conn->prepare("INSERT INTO students (first_name, last_name, email, phone, course, gender) VALUES (?, ?, ?, ?, ?, ?)");
        $stmt->execute([$firstName, $lastName, $email, $phone, $course, $gender]);
        
        // Log success or send confirmation email
        $status = "success";
        $message = "Registration successful! Welcome, $firstName.";

    } catch(PDOException $e) {
        $status = "error";
        $message = "Database error: " . $e->getMessage();
        // Log error for developers
    }
    $conn = null;
    */

    // --- 3. Prepare Final Output (Simulated for this context) ---
    
    // Set headers for a clean JSON response (recommended for AJAX/API)
    // header('Content-Type: application/json');
    // echo json_encode([
    //     'status' => 'success',
    //     'data' => [
    //         'name' => "$firstName $lastName",
    //         'program' => $course,
    //         'email' => $email
    //     ]
    // ]);
    
    // Alternatively, output the success HTML directly (standard form submission)
    ?>
    
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Registration Confirmation</title>
        <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body class="bg-gray-100 flex items-center justify-center min-h-screen">
        <div class="max-w-md w-full bg-white p-8 rounded-lg shadow-xl text-center border-t-4 border-emerald-500">
            <svg class="w-16 h-16 text-emerald-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Application Received!</h1>
            <p class="text-lg text-gray-600 mb-6">Thank you, **<?php echo $firstName . " " . $lastName; ?>**.</p>
            
            <div class="bg-emerald-50 p-4 rounded-lg text-left">
                <p class="font-semibold text-gray-700">Details Submitted:</p>
                <ul class="list-disc list-inside text-sm text-gray-600 space-y-1 mt-2">
                    <li>**Program:** <?php echo $course; ?></li>
                    <li>**Email:** <?php echo $email; ?></li>
                    <li>**Phone:** <?php echo $phone; ?></li>
                </ul>
            </div>
            
            <a href="index.html" class="mt-6 inline-block bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                Return to Home
            </a>
        </div>
    </body>
    </html>

    <?php
} else {
    // Handle cases where the script is accessed directly (not via POST)
    http_response_code(405); // Method Not Allowed
    echo "This page should only be accessed via the form submission.";
}
?>
